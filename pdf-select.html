<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>選擇考古題觀看</title>
  <script>
    function loadPDFOptions() {
      const permissions = JSON.parse(localStorage.getItem('permissions'));  
      const username = localStorage.getItem('loggedInUser');  
      const container = document.getElementById('answerContainer');
      const welcomeMessage = document.getElementById('welcomeMessage');

      console.log("👤 當前登入用戶:", username);  
      console.log("🔎 當前權限:", permissions);  

      if (!permissions || !username) {
        alert("您無權訪問此頁面，請先登入！");
        window.location.href = 'index.html';  
        return;
      }

      welcomeMessage.innerText = `歡迎，${username}！請選擇考古題觀看：`;

      const subjects = [
        { name: "台大", file: "台大全部.pdf" },
        { name: "清大", file: "清大全部.pdf" },
        { name: "成大", file: "成大全部.pdf" },
        { name: "台科", file: "台科大全部.pdf" },
        { name: "中央", file: "中央全部.pdf" },
        { name: "中興", file: "中興全部.pdf" }
      ];

      subjects.forEach(subject => {
        if (permissions[subject.name]) {  
          let button = document.createElement('button');
          button.innerText = "觀看 " + subject.name + " 解答";
          button.onclick = function() { checkAccessAndShowPDF(subject.file, subject.name); };
          container.appendChild(button);
        }
      });
    }

    function checkAccessAndShowPDF(pdfFile, subjectName) {
      const permissions = JSON.parse(localStorage.getItem('permissions'));

      console.log("🎯 嘗試打開:", pdfFile, " - 權限:", permissions);

      if (!permissions || !permissions[subjectName]) {
        alert("🚫 您無權訪問此解答！");
        window.location.href = 'index.html';  
      } else {
        localStorage.setItem('currentPDF', pdfFile);  
        window.location.href = `pdf-viewer.html`;  
      }
    }

    window.onload = loadPDFOptions;
  </script>
</head>
<body>
  <h2 id="welcomeMessage"></h2>
  <div id="answerContainer"></div>
</body>
</html>
